---
interface Props {
  projectName: string;
  projectLogo?: string;
  prTitle: string;
  prNumber: number;
  prUrl: string;
  status: "merged" | "open" | "closed";
  impactSummary: string;
  additions: number;
  deletions: number;
  reviewerQuote?: string;
  reviewerName?: string;
  reviewerAvatar?: string;
}

const {
  projectName,
  projectLogo,
  prTitle,
  prNumber,
  prUrl,
  status,
  impactSummary,
  additions,
  deletions,
  reviewerQuote,
  reviewerName,
  reviewerAvatar,
} = Astro.props;

const statusConfig = {
  merged: {
    label: "Merged",
    bgClass: "bg-purple-100 dark:bg-purple-900/40",
    textClass: "text-purple-700 dark:text-purple-400",
    icon: `<path fill-rule="evenodd" d="M5 3a2 2 0 00-2 2v1c0 .717.379 1.347.947 1.699A4.484 4.484 0 003 10.5a4.5 4.5 0 004.5 4.5A4.484 4.484 0 0010 14.053v.447a2 2 0 002 2h1a2 2 0 002-2v-1a2.001 2.001 0 00-.947-1.699A4.484 4.484 0 0015 9.5a4.5 4.5 0 00-4.5-4.5A4.484 4.484 0 008 5.947V5a2 2 0 00-2-2H5z" clip-rule="evenodd" />`,
  },
  open: {
    label: "Open",
    bgClass: "bg-green-100 dark:bg-green-900/40",
    textClass: "text-green-700 dark:text-green-400",
    icon: `<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" />`,
  },
  closed: {
    label: "Closed",
    bgClass: "bg-red-100 dark:bg-red-900/40",
    textClass: "text-red-700 dark:text-red-400",
    icon: `<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />`,
  },
};

const currentStatus = statusConfig[status];
---

<article
  class="group relative overflow-hidden rounded-xl border border-gray-200 bg-white p-5 shadow-sm transition-all duration-300 hover:-translate-y-0.5 hover:shadow-md dark:border-gray-700 dark:bg-gray-800"
>
  <!-- Header: Project Logo + Name + Status -->
  <header class="mb-4 flex items-center justify-between gap-3">
    <div class="flex items-center gap-3">
      {
        projectLogo ? (
          <img
            src={projectLogo}
            alt={`${projectName} logo`}
            class="h-8 w-8 rounded-md object-contain"
            loading="lazy"
          />
        ) : (
          <div class="flex h-8 w-8 items-center justify-center rounded-md bg-gray-100 dark:bg-gray-700">
            <svg
              class="h-5 w-5 text-gray-500 dark:text-gray-400"
              fill="currentColor"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path
                fill-rule="evenodd"
                d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"
                clip-rule="evenodd"
              />
            </svg>
          </div>
        )
      }
      <span class="font-medium text-gray-900 dark:text-white">{projectName}</span>
    </div>

    <!-- Status Badge -->
    <span
      class={`inline-flex items-center gap-1.5 rounded-full px-2.5 py-0.5 text-xs font-medium ${currentStatus.bgClass} ${currentStatus.textClass}`}
    >
      <svg class="h-3.5 w-3.5" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
        <Fragment set:html={currentStatus.icon} />
      </svg>
      {currentStatus.label}
    </span>
  </header>

  <!-- PR Title and Number -->
  <a
    href={prUrl}
    target="_blank"
    rel="noopener noreferrer"
    class="group/link mb-3 block"
  >
    <h3
      class="text-base font-semibold text-gray-900 transition-colors group-hover/link:text-blue-600 dark:text-white dark:group-hover/link:text-blue-400"
    >
      {prTitle}
    </h3>
    <span class="text-sm text-gray-500 dark:text-gray-400">#{prNumber}</span>
  </a>

  <!-- Impact Summary -->
  <p class="mb-4 text-sm leading-relaxed text-gray-600 dark:text-gray-300">
    {impactSummary}
  </p>

  <!-- Diff Stats -->
  <div
    class="mb-4 flex items-center gap-4 text-sm"
    aria-label={`${additions} additions, ${deletions} deletions`}
  >
    <span class="inline-flex items-center gap-1 text-green-600 dark:text-green-400">
      <svg
        class="h-4 w-4"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        aria-hidden="true"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 6v12m6-6H6"
        />
      </svg>
      <span class="font-medium">{additions.toLocaleString()}</span>
    </span>
    <span class="inline-flex items-center gap-1 text-red-600 dark:text-red-400">
      <svg
        class="h-4 w-4"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        aria-hidden="true"
      >
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 12H6" />
      </svg>
      <span class="font-medium">{deletions.toLocaleString()}</span>
    </span>
  </div>

  <!-- Reviewer Quote (Optional) -->
  {
    reviewerQuote && (
      <blockquote class="relative border-l-2 border-blue-200 pl-4 dark:border-blue-800">
        <p class="text-sm italic text-gray-600 dark:text-gray-400">"{reviewerQuote}"</p>
        {reviewerName && (
          <footer class="mt-2 flex items-center gap-2">
            {reviewerAvatar && (
              <img
                src={reviewerAvatar}
                alt={reviewerName}
                class="h-5 w-5 rounded-full"
                loading="lazy"
              />
            )}
            <cite class="text-xs font-medium not-italic text-gray-500 dark:text-gray-500">
              - {reviewerName}
            </cite>
          </footer>
        )}
      </blockquote>
    )
  }

  <!-- View PR Link -->
  <a
    href={prUrl}
    target="_blank"
    rel="noopener noreferrer"
    class="mt-4 inline-flex items-center gap-1.5 text-sm font-medium text-blue-600 transition-colors hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300"
  >
    View Pull Request
    <svg
      class="h-4 w-4 transition-transform group-hover:translate-x-0.5"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
      aria-hidden="true"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
      />
    </svg>
  </a>
</article>
