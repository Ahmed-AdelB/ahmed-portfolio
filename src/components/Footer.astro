---
import { GithubIcon, LinkedinIcon, TwitterIcon, RssIcon } from 'lucide-react';
import { NewsletterForm } from './features/NewsletterForm';
import { IslamicDateDisplay } from './ui/IslamicDateDisplay';
import { SITE_CONFIG } from '../site.config';

interface Props {
  lang?: 'en' | 'ar';
}

const { lang = 'en' } = Astro.props;

const currentYear = new Date().getFullYear();

const translations = {
  en: {
    stayUpdated: 'Stay Updated',
    subscribeText: 'Subscribe to my newsletter for the latest updates on Python, Security, and Open Source.',
    navigation: 'Navigation',
    social: 'Social',
    home: 'Home',
    about: 'About',
    projects: 'Projects',
    blog: 'Blog',
    github: 'GitHub',
    linkedin: 'LinkedIn',
    twitter: 'Twitter',
    rss: 'RSS Feed',
    rights: 'All rights reserved.',
    builtWith: 'Built with',
    newsletter: {
      placeholder: 'Enter your email',
      submitLabel: 'Subscribe',
      successMessage: 'Thanks for subscribing! Please check your inbox to confirm.',
      errorMessage: 'Something went wrong. Please try again.',
      requiredEmailMessage: 'Email is required.',
      invalidEmailMessage: 'Please enter a valid email address.',
    }
  },
  ar: {
    stayUpdated: 'ابق على اطلاع',
    subscribeText: 'اشترك في النشرة البريدية للحصول على أحدث المستجدات حول بايثون، الأمن السيبراني، والمصادر المفتوحة.',
    navigation: 'روابط سريعة',
    social: 'تواصل اجتماعي',
    home: 'الرئيسية',
    about: 'من أنا',
    projects: 'المشاريع',
    blog: 'المدونة',
    github: 'GitHub',
    linkedin: 'LinkedIn',
    twitter: 'Twitter',
    rss: 'خلاصة RSS',
    rights: 'جميع الحقوق محفوظة.',
    builtWith: 'تم تطويره بواسطة',
    newsletter: {
      placeholder: 'أدخل بريدك الإلكتروني',
      submitLabel: 'اشترك',
      successMessage: 'شكرًا لاشتراكك! يرجى التحقق من بريدك الإلكتروني للتأكيد.',
      errorMessage: 'حدث خطأ ما. يرجى المحاولة مرة أخرى.',
      requiredEmailMessage: 'البريد الإلكتروني مطلوب.',
      invalidEmailMessage: 'يرجى إدخال عنوان بريد إلكتروني صالح.',
    }
  }
};

const t = translations[lang];
const isRtl = lang === 'ar';

const getPath = (path: string) => lang === 'ar' ? `/ar${path}` : path;

const socialLinks = [
  {
    name: t.github,
    url: SITE_CONFIG.urls.github,
    icon: GithubIcon,
  },
  {
    name: t.linkedin,
    url: SITE_CONFIG.urls.linkedin,
    icon: LinkedinIcon,
  },
  {
    name: t.twitter,
    url: SITE_CONFIG.urls.twitter,
    icon: TwitterIcon,
  },
  {
    name: t.rss,
    url: '/rss.xml', // RSS usually doesn't have localized version unless generated separately
    icon: RssIcon,
    isInternal: true,
  },
];

const navLinks = [
  { name: t.home, url: getPath('/') },
  { name: t.about, url: getPath('/about') },
  { name: t.projects, url: getPath('/projects') },
  { name: t.blog, url: getPath('/blog') },
];
---

<footer role="contentinfo" class="border-t border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950" dir={isRtl ? 'rtl' : 'ltr'}>
  <div class="mx-auto max-w-7xl px-4 py-12 sm:px-6 lg:px-8">
    <div class="grid grid-cols-1 gap-8 lg:grid-cols-3">
      {/* Newsletter Section */}
      <div class="lg:col-span-1">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
          {t.stayUpdated}
        </h3>
        <p class="mt-4 text-sm text-gray-600 dark:text-gray-400">
          {t.subscribeText}
        </p>
        <NewsletterForm 
          client:visible
          placeholder={t.newsletter.placeholder}
          submitLabel={t.newsletter.submitLabel}
          successMessage={t.newsletter.successMessage}
          errorMessage={t.newsletter.errorMessage}
          requiredEmailMessage={t.newsletter.requiredEmailMessage}
          invalidEmailMessage={t.newsletter.invalidEmailMessage}
        />
      </div>

      {/* Quick Links Section */}
      <div class="grid grid-cols-2 gap-8 lg:col-span-2 lg:grid-cols-2">
        <div>
          <h3 class="text-sm font-semibold uppercase tracking-wider text-gray-900 dark:text-white">
            {t.navigation}
          </h3>
          <ul class="mt-4 space-y-4">
            {navLinks.map((link) => (
              <li>
                <a
                  href={link.url}
                  class="text-base text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"
                >
                  {link.name}
                </a>
              </li>
            ))}
          </ul>
        </div>
        
        <div>
           <h3 class="text-sm font-semibold uppercase tracking-wider text-gray-900 dark:text-white">
            {t.social}
          </h3>
          <ul class="mt-4 space-y-4">
            {socialLinks.map((link) => (
              <li>
                <a
                  href={link.url}
                  aria-label={link.name}
                  {...(link.isInternal ? {} : { target: '_blank', rel: 'noopener noreferrer' })}
                  class="flex items-center text-base text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"
                >
                  <link.icon className={`h-5 w-5 ${isRtl ? 'ms-2' : 'me-2'}`} />
                  {link.name}
                </a>
              </li>
            ))}
          </ul>
        </div>
      </div>
    </div>

    {/* Bottom Bar */}
    <div class="mt-12 border-t border-gray-200 pt-8 dark:border-gray-800">
      <div class="flex flex-col items-center justify-between md:flex-row">
        <p class="text-base text-gray-400 dark:text-gray-500">
          &copy; {currentYear} Ahmed Adel. {t.rights}
        </p>
        <div class="flex items-center gap-4 mt-4 md:mt-0">
          <IslamicDateDisplay client:idle lang={lang} />
          <p class="text-base text-gray-400 dark:text-gray-500">
            {t.builtWith} <a href="https://astro.build" target="_blank" rel="noopener noreferrer" class="hover:text-gray-600 dark:hover:text-gray-300">Astro</a>
          </p>
        </div>
      </div>
    </div>
  </div>
</footer>


